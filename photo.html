<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <title>사진촬영</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/photo.css">
    <style>
        #progress-bar {
            display: flex;
            padding: .8vw;
            border: .3vw solid yellow;
            border-radius: 1.5vw;
            margin-top: 2vw;
        }

        .progress-cell {
            background-color: #333;
            width: 1.5vw;
            height: 3vw;
            margin: 0.2vw
        }

        .progress-cell.on {
            background-color: yellow;
        }


    </style>
</head>
<body>
<main>
    <header class="title-header"></header>
    <p class="photo-explanation">배경과 촬영 위치를 선택해 주세요.<br/>
        사람 아이콘을 터치하여 화면 크기 및 위치 조절이
        가능합니다.
    </p>
    <div class="photo-take-box" id="photo-take-box">
        <div class="photo-preview bg-01">
            <div class="sample-human" id="photo-target">
                <div class="resizer nw"></div>
                <div class="resizer ne"></div>
                <div class="resizer sw"></div>
                <div class="resizer se"></div>
            </div>
        </div>
        <section class="photo-setting-box">
            <div class="bg-select-box">
                <div style="font-size: 1.3rem; padding: 1rem">배경 선택</div>
                <div class="photo-bg-btns">
                    <button data-bg="01" class="photo-bg-btn on">
                        <div class="photo-bg bg-01"></div>
                        한전본사
                    </button>
                    <button data-bg="02" class="photo-bg-btn">
                        <div class="photo-bg bg-02"></div>
                        로망스 다리
                    </button>
                </div>
            </div>
            <button id="shutter-btn" class="shutter">📷<span>사진찍기</span></button>
            <div class="photo-description">
                📷 사진찍기 버튼을 누르면 촬영을 시작합니다.
            </div>
        </section>
    </div>
    <div id="photo-countdown"></div>
    <div class="photo-confirm-modal hide">
        <div class="photo-confirm-title">촬영 완료</div>
        <div class="photo bg-01">
            <img src="img/photo/user.png" alt="샘플" class="sample-human" style="position: absolute; bottom: 0">
        </div>
        <div class="photo-confirm-description">
            촬영이 완료되었습니다.<br/>
            확인 후 사진 출력 버튼을 눌러주세요.
        </div>
        <button id="send-btn">사진 출력</button>
        <button id="photo-cancel-btn">취소</button>
        <div class="auto-cancel-description">
            30초간 입력이 없으면 HOME 화면으로 돌아갑니다.
        </div>
    </div>
</main>
<div class="photo-send-result-modal-bg dimmed hide">
    <div class="photo-send-result-modal">
        <div id="result-title"></div>
        <div id="result-msg"></div>
        <div class="auto-close"><span id="remain_sec">5</span>초 후에 자동으로 창이 닫힙니다.</div>
        <div id="progress-bar">
            <div class="progress-cell"></div>
            <div class="progress-cell"></div>

            <div class="progress-cell"></div>
            <div class="progress-cell"></div>

            <div class="progress-cell"></div>
            <div class="progress-cell"></div>

            <div class="progress-cell"></div>
            <div class="progress-cell"></div>

            <div class="progress-cell"></div>
        </div>
    </div>
</div>
<template id="global-menu-panel"></template>
<template id="control-menus"></template>
<script src="./js/script.js"></script>
<script>
    const photoBgBtn = document.querySelectorAll(".photo-bg-btn");
    const shutterBtn = document.getElementById("shutter-btn");
    const photoConfirmModal = document.querySelector(".photo-confirm-modal");
    const photoSendResultModal = document.querySelector(".photo-send-result-modal-bg");
    const photoCancelBtn = document.getElementById("photo-cancel-btn");
    const previewEl = document.querySelector(".photo-preview");

    const sendBtn = document.getElementById("send-btn");

    const photoSettingBox = document.querySelector(".photo-setting-box");
    const photoTakeBox = document.getElementById("photo-take-box");

    const photoCountdown = document.getElementById("photo-countdown");

    const progressCells = document.querySelectorAll(".progress-cell");

    const openPhotoConfirmModal = () => {
        photoConfirmModal.classList.remove("hide");
    }

    const closePhotoConfirmModal = () => {
        photoConfirmModal.classList.add("hide");
        photoCountdown.classList.remove("hide");
        photoTakeBox.classList.remove("hide");
    }

    const closeResultModal = () => {
        photoSendResultModal.classList.add("hide");
    }

    const takePhoto = () => {
        photoSettingBox.classList.add("hide");
        document.body.classList.add("on");
        document.querySelector(".photo-explanation").classList.add("hide");
        const shut = setTimeout(() => {
            let cnt = 7;
            photoCountdown.innerText = `${cnt}`;
            const countDown = setInterval(() => {
                cnt -= 1;
                photoCountdown.innerText = `${cnt}`;
                if (cnt === 0) {
                    previewEl.classList.add("shut");
                    photoCountdown.innerText = "";
                    setTimeout(() => {
                        previewEl.classList.remove("shut");
                        setTimeout(() => {
                            openPhotoConfirmModal();
                            clearInterval(countDown);
                            clearTimeout(shut);
                            document.querySelector(".photo-explanation").classList.remove("hide");
                            photoSettingBox.classList.remove("hide");
                            document.body.classList.remove("on");
                            photoTakeBox.classList.add("hide");
                            photoCountdown.classList.add("hide");
                        }, 100)
                    }, 100)
                }
            }, 1000)
        }, 400)
    }
    shutterBtn.addEventListener("click", takePhoto)

    const selectBg = (target) => {
        /** 버튼 변화 **/
        photoBgBtn.forEach(btn => {
            btn.classList.remove("on");
        });
        target.classList.add("on");

        /** 미리보기 변화 **/
        const photoNum = target.dataset.bg;
        previewEl.classList.remove(`bg-01`);
        previewEl.classList.remove(`bg-02`);
        previewEl.classList.add(`bg-${photoNum}`);
    }

    photoBgBtn.forEach(btn => {
        btn.addEventListener("click", () => {
            selectBg(btn);
        })
    });

    const autoClose = () => {
        let cnt = 10;
        const countDown = setInterval(() => {
            if (progressCells[10 - cnt]) {
                progressCells[10 - cnt].classList.add("on");
            }
            cnt -= 1;
            document.getElementById("remain_sec").innerText = `${Math.ceil(cnt / 2)}`;

            if (cnt === 0) {
                progressCells.forEach((cell) => {
                    cell.classList.remove("on")
                })
                clearInterval(countDown);
                closeResultModal();
                document.getElementById("remain_sec").innerText = "5";
            }
        }, 500)
    }

    const showResult = () => {
        const title = "사진 출력 완료";
        const msg = `포토프린터에서 사진을 수령해 주시기 바랍니다.<br/>이용해 주셔서 감사합니다.`
        document.getElementById("result-title").innerText = title;
        document.getElementById("result-msg").innerHTML = msg;
        photoSendResultModal.classList.remove("hide");
        autoClose(); // 5초후 자동으로 닫히도록 처리
    }

    photoCancelBtn.addEventListener("click", closePhotoConfirmModal)

    sendBtn.addEventListener("click", showResult)

    window.addEventListener("beforeunload", () => {
        closePhotoConfirmModal();
    });

    photoTakeBox.addEventListener("click", e => e.stopPropagation())

</script>
<script src="./js/zoom.js"></script>
</body>
</html>