<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <title>사진촬영</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/photo.css">
    <style>
        #progress-bar {
            display: flex;
            padding: .8vw;
            border: .3vw solid yellow;
            border-radius: 1.5vw;
            margin-top: 2vw;
        }

        .progress-cell {
            background-color: #333;
            width: 1.5vw;
            height: 3vw;
            margin: 0.2vw
        }

        .progress-cell.on {
            background-color: yellow;
        }


    </style>
</head>
<body>
<main>
    <header class="title-header"></header>
    <p class="photo-explanation">배경과 촬영 위치를 선택해 주세요.<br/>
        사람 아이콘을 터치하여 화면 크기 및 위치 조절이
        가능합니다.
    </p>
    <div class="photo-take-box" id="photo-take-box">
        <div class="photo-preview bg-01">
            <div class="sample-human" id="photo-target">
                <div class="resizer nw"></div>
                <div class="resizer ne"></div>
                <div class="resizer sw"></div>
                <div class="resizer se"></div>
            </div>
        </div>
        <section class="photo-setting-box">
            <div class="bg-select-box">
                <div style="font-size: 1.3rem; padding: 1rem">배경 선택</div>
                <div class="photo-bg-btns">
                    <button data-bg="01" class="photo-bg-btn on">
                        <div class="photo-bg bg-01"></div>
                        한전본사
                    </button>
                    <button data-bg="02" class="photo-bg-btn">
                        <div class="photo-bg bg-02"></div>
                        로망스 다리
                    </button>
                </div>
            </div>
            <button id="shutter-btn" class="shutter">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" width="8vw" height="8vw"
                     xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 198.931 198.931" style="enable-background:new 0 0 198.931 198.931;"
                     xml:space="preserve">
<g fill="currentColor">
	<g>
		<g>
			<path d="M99.469,69.561c-25.423,0-46.104,20.683-46.104,46.104s20.683,46.104,46.104,46.104
				c25.421,0,46.104-20.683,46.104-46.104S124.89,69.561,99.469,69.561z M99.469,146.91c-17.229,0-31.245-14.017-31.245-31.245
				c0-17.228,14.017-31.245,31.245-31.245c17.228,0,31.245,14.017,31.245,31.245C130.714,132.892,116.698,146.91,99.469,146.91z"/>
            <path d="M175.499,44.681h-72.315h-3.715V27.956c0-9.393-7.64-17.036-17.033-17.036H44.247c-9.393,0-17.033,7.642-17.033,17.036
				v16.726h-3.777C10.515,44.681,0,55.194,0,68.116v96.465c0,12.92,10.515,23.43,23.437,23.43h152.059
				c12.925,0,23.435-10.51,23.435-23.43V68.116C198.934,55.194,188.421,44.681,175.499,44.681z M42.07,27.956
				c0-1.201,0.976-2.176,2.177-2.176h38.189c1.199,0,2.174,0.976,2.174,2.177v16.726H42.07V27.956z M175.499,173.152H23.437
				c-4.73,0-8.578-3.846-8.578-8.571V68.116c0-4.73,3.848-8.576,8.578-8.576h5.451H42.07h42.538h18.573h72.315
				c4.73,0,8.576,3.846,8.576,8.576v96.465h0.003C184.075,169.306,180.229,173.152,175.499,173.152z"/>
            <rect x="156.012" y="71.816" width="18.989" height="14.859"/>
		</g>
	</g>
</g>
</svg>
                <span>사진찍기</span>
            </button>
            <div class="photo-description">
                사진찍기 버튼을 누르면 촬영을 시작합니다.
            </div>
        </section>
    </div>
    <div id="photo-countdown"></div>
    <div class="photo-confirm-modal hide">
        <div class="photo-confirm-title">촬영 완료</div>
        <div class="photo bg-01">
            <img src="img/photo/user.png" alt="샘플" class="sample-human" style="position: absolute; bottom: 0">
        </div>
        <div class="photo-confirm-description">
            촬영이 완료되었습니다.<br/>
            확인 후 사진 출력 버튼을 눌러주세요.
        </div>
        <button id="send-btn">사진 출력</button>
        <button id="photo-cancel-btn">취소</button>
        <div class="auto-cancel-description">
            30초간 입력이 없으면 HOME 화면으로 돌아갑니다.
        </div>
    </div>
</main>
<div class="photo-send-result-modal-bg dimmed hide">
    <div class="photo-send-result-modal">
        <div id="result-title"></div>
        <div id="result-msg"></div>
        <div class="auto-close"><span id="remain_sec">5</span>초 후에 자동으로 창이 닫힙니다.</div>
        <div id="progress-bar">
            <div class="progress-cell"></div>
            <div class="progress-cell"></div>

            <div class="progress-cell"></div>
            <div class="progress-cell"></div>

            <div class="progress-cell"></div>
            <div class="progress-cell"></div>

            <div class="progress-cell"></div>
            <div class="progress-cell"></div>

            <div class="progress-cell"></div>
        </div>
    </div>
</div>
<template id="global-menu-panel"></template>
<template id="control-menus"></template>
<script src="./js/script.js"></script>
<script>
    const photoBgBtn = document.querySelectorAll(".photo-bg-btn");
    const shutterBtn = document.getElementById("shutter-btn");
    const photoConfirmModal = document.querySelector(".photo-confirm-modal");
    const photoSendResultModal = document.querySelector(".photo-send-result-modal-bg");
    const photoCancelBtn = document.getElementById("photo-cancel-btn");
    const previewEl = document.querySelector(".photo-preview");

    const sendBtn = document.getElementById("send-btn");

    const photoSettingBox = document.querySelector(".photo-setting-box");
    const photoTakeBox = document.getElementById("photo-take-box");

    const photoCountdown = document.getElementById("photo-countdown");

    const progressCells = document.querySelectorAll(".progress-cell");

    const openPhotoConfirmModal = () => {
        photoConfirmModal.classList.remove("hide");
    }

    const closePhotoConfirmModal = () => {
        photoConfirmModal.classList.add("hide");
        photoCountdown.classList.remove("hide");
        photoTakeBox.classList.remove("hide");
    }

    const closeResultModal = () => {
        photoSendResultModal.classList.add("hide");
    }

    const takePhoto = () => {
        photoSettingBox.classList.add("hide");
        document.body.classList.add("on");
        document.querySelector(".photo-explanation").classList.add("hide");
        const shut = setTimeout(() => {
            let cnt = 7;
            photoCountdown.innerText = `${cnt}`;
            const countDown = setInterval(() => {
                cnt -= 1;
                photoCountdown.innerText = `${cnt}`;
                if (cnt === 0) {
                    previewEl.classList.add("shut");
                    photoCountdown.innerText = "";
                    setTimeout(() => {
                        previewEl.classList.remove("shut");
                        setTimeout(() => {
                            openPhotoConfirmModal();
                            clearInterval(countDown);
                            clearTimeout(shut);
                            document.querySelector(".photo-explanation").classList.remove("hide");
                            photoSettingBox.classList.remove("hide");
                            document.body.classList.remove("on");
                            photoTakeBox.classList.add("hide");
                            photoCountdown.classList.add("hide");
                        }, 100)
                    }, 100)
                }
            }, 1000)
        }, 400)
    }
    shutterBtn.addEventListener("click", takePhoto)

    const selectBg = (target) => {
        /** 버튼 변화 **/
        photoBgBtn.forEach(btn => {
            btn.classList.remove("on");
        });
        target.classList.add("on");

        /** 미리보기 변화 **/
        const photoNum = target.dataset.bg;
        previewEl.classList.remove(`bg-01`);
        previewEl.classList.remove(`bg-02`);
        previewEl.classList.add(`bg-${photoNum}`);
    }

    photoBgBtn.forEach(btn => {
        btn.addEventListener("click", () => {
            selectBg(btn);
        })
    });

    const autoClose = () => {
        let cnt = 10;
        const countDown = setInterval(() => {
            if (progressCells[10 - cnt]) {
                progressCells[10 - cnt].classList.add("on");
            }
            cnt -= 1;
            document.getElementById("remain_sec").innerText = `${Math.ceil(cnt / 2)}`;

            if (cnt === 0) {
                progressCells.forEach((cell) => {
                    cell.classList.remove("on")
                })
                clearInterval(countDown);
                closeResultModal();
                document.getElementById("remain_sec").innerText = "5";
            }
        }, 500)
    }

    const showResult = () => {
        const title = "사진 출력 완료";
        const msg = `포토프린터에서 사진을 수령해 주시기 바랍니다.<br/>이용해 주셔서 감사합니다.`
        document.getElementById("result-title").innerText = title;
        document.getElementById("result-msg").innerHTML = msg;
        photoSendResultModal.classList.remove("hide");
        autoClose(); // 5초후 자동으로 닫히도록 처리
    }

    photoCancelBtn.addEventListener("click", closePhotoConfirmModal)

    sendBtn.addEventListener("click", showResult)

    window.addEventListener("beforeunload", () => {
        closePhotoConfirmModal();
    });

    photoTakeBox.addEventListener("click", e => e.stopPropagation())

</script>
<script src="./js/zoom.js"></script>
</body>
</html>